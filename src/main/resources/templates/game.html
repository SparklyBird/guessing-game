<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Number!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #818cf8;
            --primary-dark: #6366f1;
            --secondary-color: #fb923c;
            --background-color: #0f172a;
            --card-background: #1e293b;
            --text-color: #f1f5f9;
            --light-text: #cbd5e1;
            --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --border-radius: 12px;
            --success-color: #4ade80;
            --info-color: #60a5fa;
            --error-color: #ef4444;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }
        /* Decorative circles background */
        .circles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.6;
            filter: blur(2px);
        }
        .circle-blue {
            background: radial-gradient(circle, rgba(129, 140, 248, 0.4) 0%, rgba(99, 102, 241, 0.2) 70%, transparent 100%);
        }
        .circle-orange {
            background: radial-gradient(circle, rgba(251, 146, 60, 0.4) 0%, rgba(249, 115, 22, 0.2) 70%, transparent 100%);
        }
        /* Back button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
            z-index: 100;
            text-decoration: none;
        }
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
        }
        .back-btn:active {
            transform: translateY(0);
        }
        /* Game layout */
        .game-layout {
            display: flex;
            gap: 30px;
            width: 90%;
            max-width: 1000px;
            z-index: 10;
        }
        /* Game container */
        .game-container {
            flex: 1;
            position: relative;
            text-align: center;
            background-color: var(--card-background);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        .game-icon {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: 700;
        }
        .player-info {
            font-size: 1.2em;
            color: var(--light-text);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .player-info strong {
            color: var(--text-color);
        }
        .guess-form {
            margin-bottom: 25px;
            position: relative;
        }
        .guess-inputs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            position: relative;
        }
        .guess-inputs input {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: 1.8em;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            background-color: rgba(30, 41, 59, 0.7);
            color: var(--text-color);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        .guess-inputs input:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: rgba(30, 41, 59, 0.9);
            box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.2);
        }
        .guess-button {
            background: linear-gradient(135deg, var(--success-color), #22c55e);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .guess-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(74, 222, 128, 0.4);
        }
        .guess-button:active {
            transform: translateY(0);
        }
        .game-status {
            margin-top: 25px;
            font-size: 1.1rem;
            color: var(--light-text);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .game-status strong {
            color: var(--text-color);
            font-size: 1.2rem;
        }
        .last-result {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--info-color);
            margin-top: 20px;
            padding: 12px;
            background-color: rgba(96, 165, 250, 0.1);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--info-color);
        }
        .rules-button {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(30, 41, 59, 0.7);
            color: var(--light-text);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .rules-button:hover {
            background-color: rgba(30, 41, 59, 0.9);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        /* History container */
        .history-container {
            flex: 1;
            position: relative;
            background-color: var(--card-background);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        .history-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
        }
        .history-container h3 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            position: sticky;
            top: 0;
            background-color: var(--card-background);
            padding-bottom: 10px;
            z-index: 1;
        }
        .history-container h3 i {
            color: var(--secondary-color);
        }
        .history-entries {
            display: flex;
            flex-direction: column-reverse;
        }
        .history-entry {
            background-color: rgba(30, 41, 59, 0.5);
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 12px;
            font-family: 'Courier New', monospace;
            color: var(--light-text);
            border-left: 3px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        .history-entry:hover {
            background-color: rgba(30, 41, 59, 0.7);
            transform: translateX(5px);
        }
        .history-entry:last-child {
            margin-bottom: 0;
        }
        .history-entry .guess-number {
            color: var(--secondary-color);
            font-weight: 600;
            margin-right: 8px;
        }
        /* Empty history state */
        .empty-history {
            text-align: center;
            padding: 30px 0;
            color: var(--light-text);
            font-style: italic;
        }
        .empty-history i {
            font-size: 2rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
            display: block;
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
        }
        .modal-content {
            background-color: var(--card-background);
            margin: 10% auto;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 500px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            position: relative;
        }
        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }
        .close-btn {
            color: var(--light-text);
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close-btn:hover {
            color: var(--text-color);
        }
        .modal h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8rem;
            font-weight: 700;
        }
        .modal p {
            margin-bottom: 15px;
            color: var(--light-text);
            line-height: 1.6;
        }
        .modal strong {
            color: var(--text-color);
        }
        /* Scrollbar styling */
        .history-container::-webkit-scrollbar {
            width: 8px;
        }
        .history-container::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }
        .history-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }
        .history-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        /* Shake animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }
        /* Ripple effect */
        .ripple-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.3);
            animation: ripple 1s ease-out;
            pointer-events: none;
            z-index: 1;
        }
        @keyframes ripple {
            0% {
                width: 0;
                height: 0;
                opacity: 0.8;
            }
            100% {
                width: 400px;
                height: 400px;
                opacity: 0;
            }
        }
        /* Pulsating red glow effect */
        .pulse-red {
            animation: pulseRed 1s ease-out;
        }
        @keyframes pulseRed {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        /* Responsive design */
        @media (max-width: 768px) {
            .game-layout {
                flex-direction: column;
                width: 90%;
                max-width: 500px;
            }
            .history-container {
                max-height: 300px;
            }
        }
        @media (max-width: 480px) {
            .game-container {
                padding: 30px 20px;
            }
            .history-container {
                padding: 30px 20px;
            }
            h1 {
                font-size: 1.8rem;
            }
            .guess-inputs input {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }
            .back-btn {
                top: 15px;
                left: 15px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
<!-- Decorative circles background -->
<div class="circles-container" id="circlesContainer"></div>
<!-- Back button -->
<a th:href="@{/}" class="back-btn">
    <i class="fas fa-arrow-left"></i>
    Back
</a>
<div class="game-layout">
    <div class="game-container">
        <button id="rulesBtn" class="rules-button">
            <i class="fas fa-question"></i>
        </button>
        <div class="game-icon">
            <i class="fas fa-dice"></i>
        </div>
        <h1>Make Your Guess</h1>
        <div class="player-info">
            <i class="fas fa-user"></i>
            Player: <strong th:text="${gameState.playerName.startsWith('GUEST:') ? gameState.playerName.substring(6) : gameState.playerName}">Player Name</strong>
        </div>
        <form th:action="@{/guess}" method="post" class="guess-form" id="guessForm">
            <div class="guess-inputs" id="guessInputs">
                <input type="text" id="digit1" name="digit1" maxlength="1" required pattern="[0-9]">
                <input type="text" id="digit2" name="digit2" maxlength="1" required pattern="[0-9]">
                <input type="text" id="digit3" name="digit3" maxlength="1" required pattern="[0-9]">
                <input type="text" id="digit4" name="digit4" maxlength="1" required pattern="[0-9]">
            </div>
            <button type="submit" class="guess-button">Make Guess</button>
        </form>
        <div class="game-status">
            <i class="fas fa-heart"></i>
            Tries Left: <strong th:text="${gameState.triesLeft}">8</strong>
        </div>
        <div th:if="${lastResult}" class="last-result" th:text="${lastResult}" id="lastResult">
            M:0; P:0
        </div>
    </div>
    <div class="history-container">
        <h3><i class="fas fa-history"></i> Guess History</h3>
        <div th:if="${gameState.history == null or gameState.history.isEmpty()}" class="empty-history">
            <i class="fas fa-clipboard-list"></i>
            <p>No guesses yet. Make your first guess!</p>
        </div>
        <div class="history-entries" th:if="${gameState.history != null and not gameState.history.isEmpty()}">
            <div th:each="entry, iter : ${gameState.history}"
                 class="history-entry">
                <span class="guess-number" th:text="'#' + (${gameState.history.size} - ${iter.count} + 1)">#1</span>
                <span th:text="${entry}">Guess: 1234 -> Result: M:1; P:1</span>
            </div>
        </div>
    </div>
</div>
<div id="rulesModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Game Rules Refresher</h2>
        <p><strong>P:</strong> Number of matching digits in the <strong>correct position</strong>.</p>
        <p><strong>M:</strong> Number of matching digits in the <strong>wrong position</strong>.</p>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Generate decorative circles or load from localStorage
        loadOrGenerateCircles();
        // Check if the last guess was wrong and trigger effects
        checkLastGuess();
        // Modal functionality
        const modal = document.getElementById("rulesModal");
        const btn = document.getElementById("rulesBtn");
        const span = document.getElementsByClassName("close-btn")[0];
        if (btn) {
            btn.onclick = function() {
                modal.style.display = "block";
            }
        }
        span.onclick = function() {
            modal.style.display = "none";
        }
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        // Auto-focus on first input
        const firstInput = document.getElementById('digit1');
        if (firstInput) {
            firstInput.focus();
        }
        // Auto-advance to next input
        const inputs = document.querySelectorAll('.guess-inputs input');
        inputs.forEach((input, index) => {
            input.addEventListener('input', () => {
                if (input.value.length === 1 && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
            });
            // Allow backspace to go to previous input
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && input.value === '' && index > 0) {
                    inputs[index - 1].focus();
                }
            });
        });

        // Scroll to top of history container
        const historyContainer = document.querySelector('.history-container');
        if (historyContainer) {
            historyContainer.scrollTop = 0;
        }
    });
    function checkLastGuess() {
        const lastResultElement = document.getElementById('lastResult');
        const guessInputs = document.getElementById('guessInputs');
        if (lastResultElement) {
            const lastResult = lastResultElement.textContent.trim();
            // Check if the guess was wrong (not a perfect match)
            if (lastResult && !lastResult.includes('P:4')) {
                // Add shake animation to input container
                guessInputs.classList.add('shake');
                // Create ripple effect
                createRippleEffect(guessInputs);
                // Add pulsating red glow to inputs
                const inputs = guessInputs.querySelectorAll('input');
                inputs.forEach(input => {
                    input.classList.add('pulse-red');
                });
                // Remove animation classes after animation completes
                setTimeout(() => {
                    guessInputs.classList.remove('shake');
                    inputs.forEach(input => {
                        input.classList.remove('pulse-red');
                    });
                }, 1000);
            }
        }
    }
    function createRippleEffect(container) {
        const ripple = document.createElement('div');
        ripple.className = 'ripple-effect';
        container.appendChild(ripple);
        // Remove the ripple element after animation completes
        setTimeout(() => {
            ripple.remove();
        }, 1000);
    }
    function loadOrGenerateCircles() {
        const container = document.getElementById('circlesContainer');
        const storedCircles = localStorage.getItem('decorativeCircles');
        if (storedCircles) {
            // Load circles from localStorage
            const circlesData = JSON.parse(storedCircles);
            circlesData.forEach(circleData => {
                createCircleFromData(container, circleData);
            });
        } else {
            // Generate new circles and store them
            generateAndStoreCircles(container);
        }
    }
    function createCircleFromData(container, circleData) {
        const circle = document.createElement('div');
        circle.className = `circle ${circleData.colorClass}`;
        circle.style.width = `${circleData.size}px`;
        circle.style.height = `${circleData.size}px`;
        circle.style.top = `${circleData.top}%`;
        circle.style.left = `${circleData.left}%`;
        circle.style.opacity = circleData.opacity;
        container.appendChild(circle);
    }
    function generateAndStoreCircles(container) {
        const circlesData = [];
        // Define size ranges for different circle types
        const largeCircles = { min: 250, max: 350, count: 6 };
        const mediumCircles = { min: 130, max: 200, count: 12 };
        const smallCircles = { min: 60, max: 120, count: 12 };
        // Generate large circles
        circlesData.push(...generateCircleGroup(container, largeCircles, 'large'));
        // Generate medium circles
        circlesData.push(...generateCircleGroup(container, mediumCircles, 'medium'));
        // Generate small circles
        circlesData.push(...generateCircleGroup(container, smallCircles, 'small'));
        // Store circles data in localStorage
        localStorage.setItem('decorativeCircles', JSON.stringify(circlesData));
    }
    function generateCircleGroup(container, sizeConfig, sizeType) {
        const circlesData = [];
        for (let i = 0; i < sizeConfig.count; i++) {
            const circle = document.createElement('div');
            circle.className = 'circle';
            // Determine color based on position (more blue on left, more orange on right)
            const isLeftSide = Math.random() < 0.5;
            const colorClass = isLeftSide ? 'circle-blue' : 'circle-orange';
            circle.classList.add(colorClass);
            // Random size within the specified range
            const size = Math.floor(Math.random() * (sizeConfig.max - sizeConfig.min + 1)) + sizeConfig.min;
            circle.style.width = `${size}px`;
            circle.style.height = `${size}px`;
            // Random position
            const top = Math.floor(Math.random() * 100);
            const left = Math.floor(Math.random() * 100);
            // Adjust position to ensure some circles are partially off-screen
            const adjustedTop = top - 10;
            const adjustedLeft = left - 10;
            circle.style.top = `${adjustedTop}%`;
            circle.style.left = `${adjustedLeft}%`;
            // Add some randomization to opacity for visual depth
            const opacity = (Math.random() * 0.2 + 0.4).toString();
            circle.style.opacity = opacity;
            container.appendChild(circle);
            // Store circle data
            circlesData.push({
                colorClass: colorClass,
                size: size,
                top: adjustedTop,
                left: adjustedLeft,
                opacity: opacity
            });
        }
        return circlesData;
    }
</script>
</body>
</html>